<!DOCTYPE html>
<html>

<head>
	<title>Express Rate Limit Demo</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			margin: 40px;
			background: #f5f5f5;
		}

		.container {
			max-width: 800px;
			margin: 0 auto;
			background: white;
			padding: 30px;
			border-radius: 8px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
		}

		.test-button {
			display: inline-block;
			margin: 10px;
			padding: 12px 20px;
			background: #007bff;
			color: white;
			text-decoration: none;
			border-radius: 5px;
			border: none;
			cursor: pointer;
			font-size: 14px;
		}

		.test-button:hover {
			background: #0056b3;
		}

		.basic {
			background: #28a745;
		}

		.strict {
			background: #dc3545;
		}

		.relaxed {
			background: #17a2b8;
		}

		.progressive {
			background: #ffc107;
			color: #000;
		}

		.result {
			margin: 20px 0;
			padding: 15px;
			border-radius: 5px;
			background: #f8f9fa;
			border-left: 4px solid #007bff;
			min-height: 50px;
			font-family: monospace;
		}

		.counter {
			font-weight: bold;
			color: #007bff;
		}

		h1 {
			color: #333;
			text-align: center;
		}

		h2 {
			color: #666;
			border-bottom: 2px solid #eee;
			padding-bottom: 10px;
		}

		.info {
			background: #e7f3ff;
			padding: 15px;
			border-radius: 5px;
			margin-bottom: 20px;
		}

		.status {
			display: inline-block;
			padding: 5px 10px;
			border-radius: 3px;
			font-size: 12px;
			margin-left: 10px;
		}

		.success {
			background: #d4edda;
			color: #155724;
		}

		.warning {
			background: #fff3cd;
			color: #856404;
		}

		.danger {
			background: #f8d7da;
			color: #721c24;
		}
	</style>
</head>

<body>
	<div class="container">
		<h1>ğŸš¦ Express Rate Limit å®éªŒå®¤</h1>

		<div class="info">
			<strong>ğŸ“– å®éªŒè¯´æ˜ï¼š</strong><br>
			ç‚¹å‡»ä¸åŒçš„æµ‹è¯•æŒ‰é’®ï¼Œè§‚å¯Ÿé™æµæ•ˆæœã€‚æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†å“åº”ä¿¡æ¯ã€‚
		</div>

		<h2>ğŸ§ª æµ‹è¯•åŒºåŸŸ</h2>

		<div>
			<button class="test-button basic" onclick="testEndpoint('/basic')">
				åŸºç¡€é™æµ <span class="status success">5æ¬¡/åˆ†é’Ÿ</span>
			</button>
			<button class="test-button strict" onclick="testEndpoint('/strict')">
				ä¸¥æ ¼é™æµ <span class="status danger">2æ¬¡/30ç§’</span>
			</button>
			<button class="test-button relaxed" onclick="testEndpoint('/relaxed')">
				å®½æ¾é™æµ <span class="status success">20æ¬¡/2åˆ†é’Ÿ</span>
			</button>
			<button class="test-button progressive" onclick="testEndpoint('/progressive')">
				æ¸è¿›é™æµ <span class="status warning">10æ¬¡/åˆ†é’Ÿ</span>
			</button>
		</div>

		<div>
			<button class="test-button" onclick="testEndpoint('/no-limit')" style="background: #6c757d;">
				æ— é™æµæµ‹è¯• <span class="status">æ— é™åˆ¶</span>
			</button>
			<button class="test-button" onclick="resetCounters()" style="background: #6f42c1;">
				ğŸ”„ é‡ç½®è®¡æ•°å™¨
			</button>
		</div>

		<h2>ğŸ“Š å®éªŒç»“æœ</h2>
		<div id="result" class="result">
			<p>ğŸ‘‹ ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
		</div>

		<div class="info">
			<strong>ğŸ’¡ è§‚å¯Ÿè¦ç‚¹ï¼š</strong><br>
			â€¢ å“åº”çŠ¶æ€ç ï¼š200 (æˆåŠŸ) vs 429 (é™æµ)<br>
			â€¢ å“åº”å¤´ä¿¡æ¯ï¼šRateLimit-Remaining, RateLimit-Reset<br>
			â€¢ ä¸åŒç­–ç•¥çš„é™æµè¡¨ç°å’Œç”¨æˆ·ä½“éªŒ
		</div>
	</div>

	<script>
		let requestCount = { basic: 0, strict: 0, relaxed: 0, progressive: 0, noLimit: 0 };

		async function testEndpoint (endpoint) {
			const type = endpoint.replace('/', '');
			requestCount[type === 'no-limit' ? 'noLimit' : type]++;

			try {
				const response = await fetch(endpoint, {
					method: 'GET',
					headers: { 'Content-Type': 'application/json' }
				});
				const data = await response.json();

				displayResult({
					endpoint,
					status: response.status,
					data,
					headers: {
						remaining: response.headers.get('RateLimit-Remaining'),
						reset: response.headers.get('RateLimit-Reset'),
						limit: response.headers.get('RateLimit-Limit')
					},
					count: requestCount[type === 'no-limit' ? 'noLimit' : type]
				});

			} catch (error) {
				displayResult({
					endpoint,
					status: 'ERROR',
					data: { error: error.message },
					count: requestCount[type === 'no-limit' ? 'noLimit' : type]
				});
			}
		}

		function displayResult ({ endpoint, status, data, headers, count }) {
			const resultDiv = document.getElementById('result');
			const statusClass = status === 200 ? 'success' : status === 429 ? 'danger' : 'warning';
			const timestamp = new Date().toLocaleTimeString();

			resultDiv.innerHTML = `
            <div>
              <strong>ğŸ”— æµ‹è¯•ç«¯ç‚¹ï¼š</strong> \${endpoint} 
              <span class="status \${statusClass}">ç¬¬\${count}æ¬¡è¯·æ±‚</span>
            </div>
            <div><strong>ğŸ“… æ—¶é—´ï¼š</strong> \${timestamp}</div>
            <div><strong>ğŸ“Š çŠ¶æ€ç ï¼š</strong> <span class="status \${statusClass}">\${status}</span></div>
            \${headers.remaining !== null ? \`<div><strong>ğŸ”¢ å‰©ä½™è¯·æ±‚ï¼š</strong> \${headers.remaining}/\${headers.limit}</div>\` : ''}
            \${headers.reset ? \`<div><strong>â° é‡ç½®æ—¶é—´ï¼š</strong> \${new Date(Date.now() + headers.reset * 1000).toLocaleTimeString()}</div>\` : ''}
            <div><strong>ğŸ“ å“åº”å†…å®¹ï¼š</strong></div>
            <pre style="background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto;">\${JSON.stringify(data, null, 2)}</pre>
          `;
		}

		function resetCounters () {
			requestCount = { basic: 0, strict: 0, relaxed: 0, progressive: 0, noLimit: 0 };
			document.getElementById('result').innerHTML = '<p>ğŸ”„ è®¡æ•°å™¨å·²é‡ç½®ï¼Œå¼€å§‹æ–°çš„æµ‹è¯•...</p>';
		}
	</script>
</body>

</html>