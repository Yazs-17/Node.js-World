<!DOCTYPE html>
<html>

<head>
	<title>Express Rate Limit Demo</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			margin: 40px;
			background: #f5f5f5;
		}

		.container {
			max-width: 800px;
			margin: 0 auto;
			background: white;
			padding: 30px;
			border-radius: 8px;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
		}

		.test-button {
			display: inline-block;
			margin: 10px;
			padding: 12px 20px;
			background: #007bff;
			color: white;
			text-decoration: none;
			border-radius: 5px;
			border: none;
			cursor: pointer;
			font-size: 14px;
		}

		.test-button:hover {
			background: #0056b3;
		}

		.basic {
			background: #28a745;
		}

		.strict {
			background: #dc3545;
		}

		.relaxed {
			background: #17a2b8;
		}

		.progressive {
			background: #ffc107;
			color: #000;
		}

		.result {
			margin: 20px 0;
			padding: 15px;
			border-radius: 5px;
			background: #f8f9fa;
			border-left: 4px solid #007bff;
			min-height: 50px;
			font-family: monospace;
		}

		.counter {
			font-weight: bold;
			color: #007bff;
		}

		h1 {
			color: #333;
			text-align: center;
		}

		h2 {
			color: #666;
			border-bottom: 2px solid #eee;
			padding-bottom: 10px;
		}

		.info {
			background: #e7f3ff;
			padding: 15px;
			border-radius: 5px;
			margin-bottom: 20px;
		}

		.status {
			display: inline-block;
			padding: 5px 10px;
			border-radius: 3px;
			font-size: 12px;
			margin-left: 10px;
		}

		.success {
			background: #d4edda;
			color: #155724;
		}

		.warning {
			background: #fff3cd;
			color: #856404;
		}

		.danger {
			background: #f8d7da;
			color: #721c24;
		}
	</style>
</head>

<body>
	<div class="container">
		<h1>🚦 Express Rate Limit 实验室</h1>

		<div class="info">
			<strong>📖 实验说明：</strong><br>
			点击不同的测试按钮，观察限流效果。打开浏览器控制台查看详细响应信息。
		</div>

		<h2>🧪 测试区域</h2>

		<div>
			<button class="test-button basic" onclick="testEndpoint('/basic')">
				基础限流 <span class="status success">5次/分钟</span>
			</button>
			<button class="test-button strict" onclick="testEndpoint('/strict')">
				严格限流 <span class="status danger">2次/30秒</span>
			</button>
			<button class="test-button relaxed" onclick="testEndpoint('/relaxed')">
				宽松限流 <span class="status success">20次/2分钟</span>
			</button>
			<button class="test-button progressive" onclick="testEndpoint('/progressive')">
				渐进限流 <span class="status warning">10次/分钟</span>
			</button>
		</div>

		<div>
			<button class="test-button" onclick="testEndpoint('/no-limit')" style="background: #6c757d;">
				无限流测试 <span class="status">无限制</span>
			</button>
			<button class="test-button" onclick="resetCounters()" style="background: #6f42c1;">
				🔄 重置计数器
			</button>
		</div>

		<h2>📊 实验结果</h2>
		<div id="result" class="result">
			<p>👋 点击上方按钮开始测试...</p>
		</div>

		<div class="info">
			<strong>💡 观察要点：</strong><br>
			• 响应状态码：200 (成功) vs 429 (限流)<br>
			• 响应头信息：RateLimit-Remaining, RateLimit-Reset<br>
			• 不同策略的限流表现和用户体验
		</div>
	</div>

	<script>
		let requestCount = { basic: 0, strict: 0, relaxed: 0, progressive: 0, noLimit: 0 };

		async function testEndpoint (endpoint) {
			const type = endpoint.replace('/', '');
			requestCount[type === 'no-limit' ? 'noLimit' : type]++;

			try {
				const response = await fetch(endpoint, {
					method: 'GET',
					headers: { 'Content-Type': 'application/json' }
				});
				const data = await response.json();

				displayResult({
					endpoint,
					status: response.status,
					data,
					headers: {
						remaining: response.headers.get('RateLimit-Remaining'),
						reset: response.headers.get('RateLimit-Reset'),
						limit: response.headers.get('RateLimit-Limit')
					},
					count: requestCount[type === 'no-limit' ? 'noLimit' : type]
				});

			} catch (error) {
				displayResult({
					endpoint,
					status: 'ERROR',
					data: { error: error.message },
					count: requestCount[type === 'no-limit' ? 'noLimit' : type]
				});
			}
		}

		function displayResult ({ endpoint, status, data, headers, count }) {
			const resultDiv = document.getElementById('result');
			const statusClass = status === 200 ? 'success' : status === 429 ? 'danger' : 'warning';
			const timestamp = new Date().toLocaleTimeString();

			resultDiv.innerHTML = `
            <div>
              <strong>🔗 测试端点：</strong> \${endpoint} 
              <span class="status \${statusClass}">第\${count}次请求</span>
            </div>
            <div><strong>📅 时间：</strong> \${timestamp}</div>
            <div><strong>📊 状态码：</strong> <span class="status \${statusClass}">\${status}</span></div>
            \${headers.remaining !== null ? \`<div><strong>🔢 剩余请求：</strong> \${headers.remaining}/\${headers.limit}</div>\` : ''}
            \${headers.reset ? \`<div><strong>⏰ 重置时间：</strong> \${new Date(Date.now() + headers.reset * 1000).toLocaleTimeString()}</div>\` : ''}
            <div><strong>📝 响应内容：</strong></div>
            <pre style="background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto;">\${JSON.stringify(data, null, 2)}</pre>
          `;
		}

		function resetCounters () {
			requestCount = { basic: 0, strict: 0, relaxed: 0, progressive: 0, noLimit: 0 };
			document.getElementById('result').innerHTML = '<p>🔄 计数器已重置，开始新的测试...</p>';
		}
	</script>
</body>

</html>